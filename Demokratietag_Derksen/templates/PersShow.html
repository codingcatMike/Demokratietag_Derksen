<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<button onclick="Backtosite()" style="position: absolute; top: 10px; left: 10px ; background-color: transparent;">üè†</button>
{% for person in person %}
    <div class="people" id="{{person.person_id}}"><p>{{person.name}}, {{person.surname}} || -> {{person.entry_time}} <- {{person.exit_time}} &nbsp|| &nbsp</p><p class="time">{{person.verbleibende_zeit}}</p> <button class="button"  onclick="Backtosite()">Back To Site</button></div>
{% endfor %}
<a href="/add" id="link" style="display: none; position: absolute; top: 40px; left: 10px;">Hier Eine Person Registrieren</a>

<script>
function  Backtosite(){
    location.assign('/check')
}

function Show(x) {
  const elements = document.querySelectorAll(`div[id="${x}"]`);
  if (elements.length === 0) {
    document.getElementById("link").style.display = "block";
  } else {
    elements.forEach((element) => {
      element.style.display = 'flex';
    });
  }
}

 function pruefeDauer() {
  // Alle Elemente mit der Klasse "people" ausw√§hlen
  const peopleElements = document.querySelectorAll('.time');

  // Durchlaufen aller Elemente
  peopleElements.forEach((element) => {
    // Inhalt des Elements auslesen
    const inhalt = element.textContent;
    if (inhalt.startsWith('-')) {
      element.classList.add('red');
    } else {
    // Zeitformat: MM:SS
    const [ stunden ,minuten, sekunden] = inhalt.split(':').map(Number);

    // Gesamtsekunden berechnen
    const gesamtSekunden = minuten * 60 + sekunden +  stunden * 60 * 60;


    // Pr√ºfen, ob die Dauer kleiner als 0:02:00 ist
    if (gesamtSekunden < 120) {
      element.classList.add('o');
    }
    // Pr√ºfen, ob die Dauer zwischen 0:02:00 und 0:05:00 liegt
    else if (gesamtSekunden >= 120 && gesamtSekunden < 300) {
      element.classList.add('orange');
    }
    // Pr√ºfen, ob die Dauer gr√∂√üer als 0:05:00 ist
    else {
      element.classList.add('green');
    }
 }});
}


// Funktion aufrufen
pruefeDauer();

function reloadpage() {
    const formData = new FormData();
    formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    fetch('/update_item', { method: 'POST', body: formData })
        .then(response => response.json())
        .then(data => {
            if (data.updated) {
                setTimeout(function(){ window.location.reload(); }, 5000);
            }
        });
}

reloadpage()
Show(localStorage.getItem('Person'))

</script>
</body>
</html>
<style>
    body{
        margin: 0px;
        font-family: Arial, Helvetica, sans-serif;
    }
    .people {
        background-color: #464646;
        margin: 0px;
        height:  50px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: rgb(182, 179, 179);
        display: none;
    }
    .red {
  color: red;
}

.orange {
    color: orange;
}
.o {
  color: rgb(255, 115, 0);

}
.green {
    color: rgb(0, 231, 0);
}
.button {
    margin-left: 40px;
    
}

</style>